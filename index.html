<!doctype html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" integrity="sha512-894YE6QWD5I59HgZOGReFYm4dnWc1Qt5NtvYSaNcOP+u1T9qYdvdihz0PPSiiqn/+/3e7Jo4EaG7TubfWGUrMQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>

    <!-- Datatable-->
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.25/css/jquery.dataTables.css">
    <script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/1.10.25/js/jquery.dataTables.js"></script>

    <title>Hello, world!</title>
    <style>
        main {
            height: 100vh;
            display: flex;
            flex-direction: column;
        }

        img {
            width: 100px;
        }

        .section_up {
            padding: 3em 0 5em 0;
            /* background: linear-gradient(-45deg, #ee7752, #e73c7e, #23a6d5, #23d5ab); */
            background: linear-gradient(-45deg, #110805, #525151, #012d3d, #000000);
	        background-size: 400% 400%;
	        animation: gradient 15s ease infinite;
        }

        .section_down {
            border-top-left-radius: 2.5rem;
            border-top-right-radius: 2.5rem;
            margin-top: -3rem;
            flex-grow: 1;
            background-color: white;
            padding: 3em 0;
        }

        @keyframes gradient {
            0% {
                background-position: 0% 50%;
            }
            50% {
                background-position: 100% 50%;
            }
            100% {
                background-position: 0% 50%;
            }
        }
    </style>
  </head>
  <body>
    <main>
        <section class="section_up">
            <h1 class="text-center text-light mb-5">Product Management</h1>
            <div class="container">
                <!-- Button trigger modal AddProduct-->
                <button type="button" class="btn btn-success mt-5" data-bs-toggle="modal" data-bs-target="#addProduct">
                    Add Product
                </button>
                
                <!-- Modal AddProduct-->
                <div class="modal fade" id="addProduct" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
                    <form>
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title" id="exampleModalLabel">Add New Product</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                            </div>
                            <div class="modal-body">

                                    <div class="mb-3">
                                        <label for="name" class="form-label">Product Name</label>
                                        <input type="text" class="form-control" id="name" name="name">
                                    </div>
                                    <div class="mb-3">
                                        <label for="purchase_price" class="form-label">Purchase Price</label>
                                        <input type="text" class="form-control" id="purchase_price" name="purchase_price">
                                    </div>
                                    <div class="mb-3">
                                        <label for="sell_price" class="form-label">Sell Price</label>
                                        <input type="text" class="form-control" id="sell_price" name="sell_price">
                                    </div>
                                    <div class="mb-3">
                                        <label for="stock" class="form-label">Stock</label>
                                        <input type="text" class="form-control" id="stock" name="stock">
                                    </div>
                                    <div class="mb-3">
                                        <label for="img" class="form-label">Upload Image</label>
                                        <input class="form-control form-control-sm" id="img" type="file" name="img">
                                    </div>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                                <button type="submit" class="btn btn-primary">Save changes</button>
                            </div>
                        </div>
                    </div>
                    </form>
                </div>  
                <!-- End Of Modal AddProduct-->

                <!-- Modal Edit Product-->
                <div class="modal fade" id="editProduct" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
                    <form>
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title" id="exampleModalLabel">Edit Product</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                            </div>
                            <div class="modal-body">

                                    <div class="mb-3">
                                        <label for="nameEdit" class="form-label">Product Name</label>
                                        <input type="text" name="id" id="idEdit" hidden>
                                        <input type="text" class="form-control" id="nameEdit" name="nameEdit">
                                    </div>
                                    <div class="mb-3">
                                        <label for="purchase_priceEdit" class="form-label">Purchase Price</label>
                                        <input type="text" class="form-control" id="purchase_priceEdit" name="purchase_priceEdit">
                                    </div>
                                    <div class="mb-3">
                                        <label for="sell_priceEdit" class="form-label">Sell Price</label>
                                        <input type="text" class="form-control" id="sell_priceEdit" name="sell_priceEdit">
                                    </div>
                                    <div class="mb-3">
                                        <label for="stockEdit" class="form-label">Stock</label>
                                        <input type="text" class="form-control" id="stockEdit" name="stockEdit">
                                    </div>
                                    <div class="mb-3">
                                        <label for="imgEdit" class="form-label">Upload Image</label>
                                        <input class="form-control form-control-sm" id="imgEdit" type="file" name="imgEdit">
                                    </div>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                                <button type="submit" class="btn btn-primary">Save changes</button>
                            </div>
                        </div>
                    </div>
                    </form>
                </div>
                <!-- End Of Modal EditProduct -->
            </div>
        </section>
        <section class="section_down mt-n1">
            <div class="container">
                <table id="table_id" class="display">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>NAME</th>
                            <th>PURCHASE PRICE</th>
                            <th>SELL PRICE</th>
                            <th>STOCK</th>
                            <th>IMAGE</th>
                            <th>ACTION</th>
                        </tr>
                    </thead>
                    <tbody>
                    </tbody>
                </table> 
            </div>
        </section>
    </main>

    <!-- Optional JavaScript; choose one of the two! -->
    <script>
        $(document).ready( function () {
            $('#table_id').DataTable();
            getData();
        } );

        // DEVELOPMENT URL
        // const URL = "http://localhost:5000"
        const URL = "https://hapi-server-fauzan.herokuapp.com"
        const URL_API = URL+"/"+"product"

        // POPULATE THE FORM
        function populateForm(data) {
            document.getElementById('idEdit').value = data.id
            document.getElementById('nameEdit').value = data.name
            document.getElementById('purchase_priceEdit').value = data.purchase_price
            document.getElementById('sell_priceEdit').value = data.sell_price
            document.getElementById('stockEdit').value = data.stock
        }

        // GET PRODUCT
        function getData() {
            fetch(URL_API)
            .then(res => res.json())
            .then(data => displayData(data.data.products))
        }

        // GET PRODUCT BY ID
        function getDataById(id) {
            fetch(URL_API+"/"+id)
            .then(res => res.json())
            .then(data => {
                populateForm(data.data.product)
            })
        }

        // LIST DATA INTO TABLE
        function displayData(data) {
            const tbody = document.querySelector('#table_id tbody')
            tbody.innerHTML = ''
            data.map(val=> {
                console.log(val.img)
                tbody.innerHTML += `<tr><th>${val.id}</th><th>${val.name}</th><th>${val.purchase_price}</th><th>${val.sell_price}</th><th>${val.stock}</th><th><img src="${URL+"/"+val.img}" alt="${val.name}" /></th><th><button class="btn btn-warning" onClick=editData("${val.id}")>Edit</button><button class="btn btn-danger" onClick=deleteData("${val.id}")>Delete</button></th></tr>`
            })
        }
        
        // UPDATE PRODUCT
        function editData(id) {
            $('#editProduct').modal('show')
            getDataById(id)
        }

        // UPDATE ON SUBMIT
        document.getElementById('editProduct')
        .addEventListener('submit', (e)=> {
            e.preventDefault()

            const id = document.getElementById('idEdit').value
            const name = document.getElementById('nameEdit').value
            const purchase_price = document.getElementById('purchase_priceEdit').value
            const sell_price = document.getElementById('sell_priceEdit').value
            const stock = document.getElementById('stockEdit').value
            const img = document.getElementById('imgEdit')

            const formData = new FormData()
            formData.append('name', name)
            formData.append('purchase_price', purchase_price)
            formData.append('sell_price', sell_price)
            formData.append('stock', stock)
            formData.append('img', img.files[0])

            fetch(URL_API+"/"+id, {
                method: "put",
                header: "application/json",
                body: formData
            })
            .then(res => res.json())
            .then(data => {
                $('#editProduct').modal('hide')
                alert(data.message)
                getData()
            })
        })

        // DELETE PRODUCT
        function deleteData(id) {
            fetch(URL_API+"/"+id, {
                method: "delete"
            })
            .then(res => res.json())
            .then(data => {
                alert(data.message)
                getData()
            })
        }

        // ADD PRODUCT
        const form = document.getElementById('addProduct')
        form.addEventListener('submit', (e)=> {
            e.preventDefault()

            const name = document.getElementById('name').value
            const purchase_price = document.getElementById('purchase_price').value
            const sell_price = document.getElementById('sell_price').value
            const stock = document.getElementById('stock').value
            const img = document.getElementById('img')

            const formData = new FormData()
            formData.append('name', name)
            formData.append('purchase_price', purchase_price)
            formData.append('sell_price', sell_price)
            formData.append('stock', stock)
            formData.append('img', img.files[0])

            fetch(URL_API, {
                method: "post",
                header: "application/json",
                body: formData
            })
            .then(res => res.json())
            .then(data => {
                $('#addProduct').modal('hide')
                alert(data.message)
                getData()
            })
        })
    </script>

    <!-- Option 1: Bootstrap Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>

    <!-- Option 2: Separate Popper and Bootstrap JS -->
    <!--
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js" integrity="sha384-IQsoLXl5PILFhosVNubq5LC7Qb9DXgDA9i+tQ8Zj3iwWAwPtgFTxbJ8NT4GN1R8p" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.min.js" integrity="sha384-cVKIPhGWiC2Al4u+LWgxfKTRIcfu0JTxR+EQDz/bgldoEyl4H0zUF0QKbrJ0EcQF" crossorigin="anonymous"></script>
    -->
  </body>
</html>
